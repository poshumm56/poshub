-- ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Fluent (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
local Window = Fluent:CreateWindow({
    Title = "poshub " .. Fluent.Version,
    SubTitle = "by cherry._.54",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

------------------------------------------------------------
-- üîπ Mini Dock (‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠) (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MiniDock"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

local MiniButton = Instance.new("TextButton")
MiniButton.Name = "MiniButton"
MiniButton.Parent = ScreenGui
MiniButton.Text = "‚öô poshub"
MiniButton.Font = Enum.Font.GothamBold
MiniButton.TextColor3 = Color3.fromRGB(255,255,255)
MiniButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
MiniButton.BorderSizePixel = 0
MiniButton.Size = UDim2.new(0, 130, 0, 36)
MiniButton.Position = UDim2.new(0.02, 0, 0.4, 0)
MiniButton.Visible = false
MiniButton.Active = true
MiniButton.Draggable = true

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 8)
Corner.Parent = MiniButton

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(120, 120, 255)
Stroke.Thickness = 1.2
Stroke.Parent = MiniButton

MiniButton.MouseEnter:Connect(function()
	MiniButton.BackgroundColor3 = Color3.fromRGB(65,65,85)
end)
MiniButton.MouseLeave:Connect(function()
	MiniButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
end)

MiniButton.MouseButton1Click:Connect(function()
	Window:Minimize(false)
end)

Window.OnMinimize = function(state)
	MiniButton.Visible = state
end

------------------------------------------------------------
-- üîπ ‡πÅ‡∏ó‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
local Tabs = {
    Aimbot = Window:AddTab({ Title = "Aimbot", Icon = "" }),
    Esp = Window:AddTab({ Title = "ESP", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

------------------------------------------------------------
-- üî∏ Aimbot Tab (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
Tabs.Aimbot:AddParagraph({
    Title = "‡∏ö‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏ß‡∏¢",
    Content = "‡πÉ‡∏ä‡πâ‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà‡∏ä‡∏≤‡∏¢"
})

local ToggleAimbot = Tabs.Aimbot:AddToggle("AimbotEnabled", { Title = "‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Aimbot", Default = false }):OnChanged(function()
    print("Aimbot ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î:", Options.AimbotEnabled.Value)
end)

Tabs.Aimbot:AddInput("AimWidth", {
    Title = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á (FOV)",
    Default = "100",
    Placeholder = "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô 100",
    Numeric = true,
    Finished = true,
    Callback = function(Value)
        print("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô:", Value)
    end
})

Tabs.Aimbot:AddDropdown("AimPart", {
    Title = "‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤",
    Values = {"Head (‡∏´‡∏±‡∏ß)", "Torso (‡∏ï‡∏±‡∏ß)", "RootPart (‡∏Å‡∏•‡∏≤‡∏á‡∏ï‡∏±‡∏ß)"},
    Multi = false,
    Default = 1,
}):OnChanged(function(Value)
    print("‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤:", Value)
end)


Tabs.Aimbot:AddDropdown("AimMode", {
    Title = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î",
    Values = {"‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÑ‡∏ß‡πÜ", "‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πâ‡∏≤‡πÜ", "‡∏Å‡∏•‡∏≤‡∏á‡πÜ", "‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ"},
    Multi = false,
    Default = 1,
}):OnChanged(function(Value)
    print("‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:", Value)
end)

Tabs.Aimbot:AddInput("Transparency", {
    Title = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ (0-1)",
    Default = "0.0", 
    Placeholder = "‡πÄ‡∏ä‡πà‡∏ô 0.0 (‡∏ó‡∏∂‡∏ö) - 1.0 (‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™)",
    Numeric = true,
    Finished = true,
    Callback = function(Value)
        print("‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™:", Value)
    end
})

Tabs.Aimbot:AddToggle("WallHack", { Title = "‡∏ó‡∏∞‡∏•‡∏∏‡∏Å‡∏≥‡πÅ‡∏û‡∏á", Default = false }):OnChanged(function()
    print("‡∏ó‡∏∞‡∏•‡∏∏‡∏Å‡∏≥‡πÅ‡∏û‡∏á:", Options.WallHack.Value)
end)

Tabs.Aimbot:AddToggle("NoTeamLock", { Title = "‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏î‡∏±‡∏ô", Default = false }):OnChanged(function()
    print("‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏î‡∏±‡∏ô:", Options.NoTeamLock.Value)
end)

Tabs.Aimbot:AddToggle("QuickToggle", { Title = "‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πÜ (Right Shift)", Default = false }):OnChanged(function()
    print("‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πÜ:", Options.QuickToggle.Value)
end)

------------------------------------------------------------
-- üî∏ ESP Tab (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
Tabs.Esp:AddParagraph({
    Title = "ESP System",
    Content = "‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏°‡∏≠‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≥‡πÅ‡∏û‡∏á"
})

Tabs.Esp:AddToggle("ESP_Name", { Title = "‡∏î‡∏π‡∏ä‡∏∑‡πà‡∏≠", Default = false })
Tabs.Esp:AddToggle("ESP_Health", { Title = "‡∏î‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏î", Default = false })
Tabs.Esp:AddToggle("ESP_Box", { Title = "‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏£‡∏≠‡∏ö‡πÜ", Default = false })
Tabs.Esp:AddToggle("ESP_Line", { Title = "‡πÄ‡∏™‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏´‡∏≤‡∏Ñ‡∏ô", Default = false })
Tabs.Esp:AddToggle("ESP_Glow", { Title = "‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏ó‡∏∞‡∏•‡∏∏‡∏Å‡∏≥‡πÅ‡∏û‡∏á", Default = false })
Tabs.Esp:AddToggle("ESP_TeamColor", { Title = "‡∏™‡∏µ‡∏ó‡∏µ‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô", Default = false })

------------------------------------------------------------
-- üîπ Settings / SaveManager (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "poshub",
    Content = "‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (LeftControl: ‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢ | RightShift: QuickToggle Aimbot)",
    Duration = 8
})

SaveManager:LoadAutoloadConfig()


------------------------------------------------------------
-- üõ†Ô∏è Global Variables (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

------------------------------------------------------------
-- ‚≠ï FOV Circle (‡∏ß‡∏á‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤ - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
------------------------------------------------------------
local FOV_ScreenGui = Instance.new("ScreenGui")
FOV_ScreenGui.Name = "FOV_ScreenGui"
FOV_ScreenGui.IgnoreGuiInset = true
FOV_ScreenGui.ResetOnSpawn = false
FOV_ScreenGui.Parent = game:GetService("CoreGui")

local FOVCircle = Instance.new("Frame")
FOVCircle.Name = "FOVCircle"
FOVCircle.Parent = FOV_ScreenGui
FOVCircle.BackgroundTransparency = 1
FOVCircle.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
FOVCircle.BorderSizePixel = 0 
FOVCircle.ZIndex = 1
FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
FOVCircle.Position = UDim2.new(0.5, 0, 0.5, 0)

local FOV_Corner = Instance.new("UICorner")
FOV_Corner.Parent = FOVCircle

local FOV_Stroke = Instance.new("UIStroke")
FOV_Stroke.Parent = FOVCircle
FOV_Stroke.Color = Color3.fromRGB(0, 0, 0)
FOV_Stroke.Thickness = 1.5 
FOV_Stroke.Transparency = 0 

RunService.RenderStepped:Connect(function()
    local aimWidth = tonumber(Options.AimWidth.Value) or 100
    local transparency = tonumber(Options.Transparency.Value) or 0.0 
    local isEnabled = Options.AimbotEnabled.Value

    FOVCircle.Size = UDim2.fromOffset(aimWidth * 2, aimWidth * 2)
    FOV_Corner.CornerRadius = UDim.new(1, 0)

    FOV_Stroke.Transparency = transparency
    
    FOVCircle.Visible = isEnabled
end)


------------------------------------------------------------
-- üéØ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Aimbot (Logic - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Raycasting)
------------------------------------------------------------

local function GetSmoothingFactor()
    local mode = Options.AimMode.Value
    if mode == "‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÑ‡∏ß‡πÜ" then
        return 1.0
    elseif mode == "‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πâ‡∏≤‡πÜ" then
        return 0.08 
    elseif mode == "‡∏Å‡∏•‡∏≤‡∏á‡πÜ" then
        return 0.3
    elseif mode == "‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ" then
        return 0.15
    end
    return 1.0
end

local function GetAimPartName()
    local part = Options.AimPart.Value
    if part == "Head (‡∏´‡∏±‡∏ß)" then
        return "Head"
    elseif part == "Torso (‡∏ï‡∏±‡∏ß)" then
        -- Torso ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏Ñ‡∏∑‡∏≠ UpperTorso ‡πÉ‡∏ô R15 ‡∏´‡∏£‡∏∑‡∏≠ Torso ‡πÉ‡∏ô R6
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        if char:FindFirstChild("UpperTorso") then
            return "UpperTorso"
        else
            return "Torso"
        end
    else
        return "HumanoidRootPart"
    end
end


local function GetClosestTarget()
    local aimWidth = tonumber(Options.AimWidth.Value) or 100
    local closestDistance = aimWidth
    local targetPlayer = nil
    local aimPartName = GetAimPartName()
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChildOfClass("Humanoid") and player.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
            if not Options.NoTeamLock.Value or player.Team ~= LocalPlayer.Team then
                local targetPart = player.Character:FindFirstChild(aimPartName) 
                if targetPart then
                    local pos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    
                    if onScreen then
                        local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
                        local distance = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                        
                        if distance < aimWidth then
                            if distance < closestDistance then
                                closestDistance = distance
                                targetPlayer = player
                            end
                        end
                    end
                end
            end
        end
    end
    return targetPlayer
end

RunService.RenderStepped:Connect(function()
    if Options.AimbotEnabled.Value then
        local target = GetClosestTarget()
        
        if target and target.Character then
            local aimPartName = GetAimPartName()
            local targetPart = target.Character:FindFirstChild(aimPartName)
            
            if targetPart then
                local targetPos = targetPart.Position
                local shouldAim = false

                if Options.WallHack.Value then
                    shouldAim = true
                else
                    -- **Raycasting Logic ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô**
                    local rayOrigin = Camera.CFrame.Position
                    local rayDirection = (targetPos - rayOrigin)
                    local rayDistance = rayDirection.Magnitude
                    
                    local rayParams = RaycastParams.new()
                    rayParams.FilterType = Enum.RaycastFilterType.Exclude
                    
                    -- ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Raycast
                    rayParams.FilterDescendantsInstances = {LocalPlayer.Character, target.Character}
                    
                    local raycastResult = workspace:Raycast(rayOrigin, rayDirection.Unit * rayDistance, rayParams)
                    
                    if not raycastResult then
                        -- ‡∏Å‡∏£‡∏ì‡∏µ 1: ‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢ (‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)
                        shouldAim = true
                    else
                        -- ‡∏Å‡∏£‡∏ì‡∏µ 2: ‡∏ä‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ä‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏Å‡∏•‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                        -- ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô‡∏ñ‡πâ‡∏≤ Raycast ‡∏ä‡∏ô TargetPart ‡πÄ‡∏≠‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô)
                        local hitInstance = raycastResult.Instance
                        if hitInstance:IsDescendantOf(target.Character) then
                            -- ‡∏ä‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô Arm/Leg) ‡∏ã‡∏∂‡πà‡∏á‡πÇ‡∏≠‡πÄ‡∏Ñ
                            shouldAim = true
                        elseif raycastResult.Distance >= rayDistance - 0.2 then
                            -- ‡∏ä‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡πÅ‡∏ï‡πà‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å (‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô)
                            shouldAim = true
                        end
                    end
                end

                if shouldAim then
                    local smoothing = GetSmoothingFactor()
                    local currentCFrame = Camera.CFrame
                    local desiredCFrame = CFrame.new(currentCFrame.Position, targetPos)
                    
                    Camera.CFrame = currentCFrame:Lerp(desiredCFrame, smoothing)
                end
            end
        end
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if input.KeyCode == Enum.KeyCode.RightShift and Options.QuickToggle.Value and not gameProcessedEvent then
        Options.AimbotEnabled.Value = not Options.AimbotEnabled.Value
        ToggleAimbot:SetValue(Options.AimbotEnabled.Value)
        Fluent:Notify({
            Title = "QuickToggle",
            Content = "Aimbot: " .. (Options.AimbotEnabled.Value and "‡πÄ‡∏õ‡∏¥‡∏î" or "‡∏õ‡∏¥‡∏î"),
            Duration = 2
        })
    end
end)

------------------------------------------------------------
-- üåü ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ESP (Logic - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç UI ‡∏Ñ‡πâ‡∏≤‡∏á)
------------------------------------------------------------
local ESPGui = Instance.new("ScreenGui")
ESPGui.Name = "poshub_ESP_GUI"
ESPGui.IgnoreGuiInset = true
ESPGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ESPGui.ResetOnSpawn = false
ESPGui.Parent = game:GetService("CoreGui")

local ESPDrawings = {}

local function GetESPColor(player)
    if Options.ESP_TeamColor.Value and player.Team then
        return player.Team.TeamColor.Color
    end
    if player.Team ~= LocalPlayer.Team then
        return Color3.fromRGB(255, 0, 0)
    end
    return Color3.fromRGB(0, 255, 0)
end

local function Update2DESP(player, rootPart, color)
    local draw = ESPDrawings[player.UserId]
    if not draw or not draw.NameLabel or not draw.NameLabel.Parent then
        draw = {
            NameLabel = Instance.new("TextLabel"),
            HealthBarBG = Instance.new("Frame"),
            HealthBarFG = Instance.new("Frame"),
            BoxFrame = Instance.new("Frame"),
            LineFrame = Instance.new("Frame")
        }
        
        draw.NameLabel.Parent = ESPGui
        draw.NameLabel.BackgroundTransparency = 1
        draw.NameLabel.TextScaled = true
        draw.NameLabel.Font = Enum.Font.SourceSans
        draw.NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        draw.NameLabel.ZIndex = 3
        
        draw.HealthBarBG.Parent = ESPGui
        draw.HealthBarBG.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        draw.HealthBarBG.BackgroundTransparency = 0.3
        draw.HealthBarBG.BorderSizePixel = 0
        draw.HealthBarBG.ZIndex = 2

        draw.HealthBarFG.Parent = draw.HealthBarBG
        draw.HealthBarFG.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        draw.HealthBarFG.BorderSizePixel = 0
        draw.HealthBarFG.ZIndex = 3
        
        draw.BoxFrame.Parent = ESPGui
        draw.BoxFrame.BackgroundTransparency = 1
        draw.BoxFrame.BorderSizePixel = 1
        draw.BoxFrame.BorderColor3 = color
        draw.BoxFrame.ZIndex = 2
        
        draw.LineFrame.Parent = ESPGui
        draw.LineFrame.BackgroundTransparency = 0
        draw.LineFrame.BorderSizePixel = 0
        draw.LineFrame.BackgroundColor3 = color
        draw.LineFrame.ZIndex = 2

        ESPDrawings[player.UserId] = draw
    end

    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then 
        -- ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ humanoid
        for _, obj in pairs(draw) do
            if type(obj) == 'Instance' and obj.Parent == ESPGui then
                obj.Visible = false
            end
        end
        return 
    end

    local headPos, headOnScreen = Camera:WorldToViewportPoint(rootPart.Position + Vector3.new(0, 2.5, 0))
    local footPos, footOnScreen = Camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 2.5, 0))

    local onScreen = headOnScreen or footOnScreen
    
    -- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    local isVisible = onScreen 
    local height = math.abs(headPos.Y - footPos.Y)
    local width = height * 0.5 

    local boxCenter = Vector2.new(footPos.X, footPos.Y - height/2)
    local boxPosition = UDim2.fromOffset(boxCenter.X - width/2, boxCenter.Y - height/2)
    local boxSize = UDim2.fromOffset(width, height)


    -- === Box ESP ===
    -- *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ Visible ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö OnScreen ‡πÅ‡∏•‡∏∞ Option.Value ***
    draw.BoxFrame.Visible = Options.ESP_Box.Value and isVisible
    if draw.BoxFrame.Visible then
        draw.BoxFrame.Position = boxPosition
        draw.BoxFrame.Size = boxSize
        draw.BoxFrame.BorderColor3 = color
    else
         draw.BoxFrame.Size = UDim2.new(0,0,0,0) -- ‡∏Ç‡∏ô‡∏≤‡∏î 0 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î
    end
    
    -- === Name ESP ===
    draw.NameLabel.Visible = Options.ESP_Name.Value and isVisible
    if draw.NameLabel.Visible then
        draw.NameLabel.Position = UDim2.fromOffset(boxCenter.X - width/2, boxPosition.Y.Offset - 15)
        draw.NameLabel.Size = UDim2.fromOffset(width, 15)
        draw.NameLabel.Text = player.Name
        draw.NameLabel.TextColor3 = color
    else
         draw.NameLabel.Size = UDim2.new(0,0,0,0)
    end

    -- === Health ESP ===
    draw.HealthBarBG.Visible = Options.ESP_Health.Value and isVisible
    if draw.HealthBarBG.Visible then
        local health = humanoid.Health / humanoid.MaxHealth
        local barHeight = height
        local barWidth = 3
        
        draw.HealthBarBG.Position = UDim2.fromOffset(boxPosition.X.Offset - barWidth - 2, boxPosition.Y.Offset)
        draw.HealthBarBG.Size = UDim2.fromOffset(barWidth, barHeight)

        draw.HealthBarFG.Size = UDim2.new(1, 0, health, 0)
        draw.HealthBarFG.Position = UDim2.new(0, 0, 1 - health, 0) 
        draw.HealthBarFG.BackgroundColor3 = Color3.fromHSV(health / 3, 1, 1)
    else
         draw.HealthBarBG.Size = UDim2.new(0,0,0,0)
    end
    
    -- === Line ESP ===
    draw.LineFrame.Visible = Options.ESP_Line.Value and isVisible
    if draw.LineFrame.Visible then
        local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if myRoot then
            local myPos, myOnScreen = Camera:WorldToViewportPoint(myRoot.Position)
            
            if myOnScreen then
                local lineStart = Vector2.new(myPos.X, myPos.Y)
                local lineEnd = Vector2.new(footPos.X, footPos.Y)
                local distance = (lineStart - lineEnd).Magnitude
                
                local angle = math.atan2(lineEnd.Y - lineStart.Y, lineEnd.X - lineStart.X)
                
                draw.LineFrame.Position = UDim2.fromOffset(lineStart.X, lineStart.Y)
                draw.LineFrame.Size = UDim2.fromOffset(distance, 1.5)
                draw.LineFrame.Rotation = math.deg(angle)
                draw.LineFrame.BackgroundColor3 = color
                draw.LineFrame.AnchorPoint = Vector2.new(0, 0.5)
            else
                draw.LineFrame.Visible = false
            end
        else
             draw.LineFrame.Visible = false
        end
    else
         draw.LineFrame.Visible = false
    end
end

local function UpdateGlowESP(player, color)
    local draw = ESPDrawings[player.UserId] or {}
    local highlight = draw.Highlight
    local glowEnabled = Options.ESP_Glow.Value
    
    if glowEnabled and player.Character then
        if not highlight or not highlight.Parent then
            highlight = Instance.new("Highlight")
            highlight.Parent = player.Character
            draw.Highlight = highlight
            ESPDrawings[player.UserId] = draw
        end
        highlight.FillColor = color
        highlight.OutlineColor = color
        highlight.OutlineTransparency = 0.5
        highlight.FillTransparency = 0.5
        highlight.Enabled = true
    else
        if highlight then
            highlight.Enabled = false
        end
    end
end

RunService.Heartbeat:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        local character = player.Character
        local draw = ESPDrawings[player.UserId]

        local shouldShow = player ~= LocalPlayer and 
                           character and 
                           character:FindFirstChild("HumanoidRootPart") and 
                           character:FindFirstChildOfClass("Humanoid") and 
                           character:FindFirstChildOfClass("Humanoid").Health > 0 and
                           (not Options.NoTeamLock.Value or player.Team ~= LocalPlayer.Team)

        if shouldShow then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            local color = GetESPColor(player)
            
            ESPDrawings[player.UserId] = ESPDrawings[player.UserId] or {}
            
            Update2DESP(player, rootPart, color)
            UpdateGlowESP(player, color)
        else
            -- üåü ‡∏™‡∏±‡πà‡∏á‡∏ã‡πà‡∏≠‡∏ô/‡∏õ‡∏¥‡∏î Highlight ‡πÅ‡∏•‡∏∞ UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á
            if draw then
                for _, obj in pairs(draw) do
                    if type(obj) == 'Instance' and obj.Parent == ESPGui then
                        obj.Visible = false
                    elseif obj.ClassName == "Highlight" then
                        obj.Enabled = false
                    end
                end
            end
        end
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if ESPDrawings[player.UserId] then
        for _, obj in pairs(ESPDrawings[player.UserId]) do
            if obj then
                obj:Destroy()
            end
        end
        ESPDrawings[player.UserId] = nil
    end
end)

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if ESPDrawings[player.UserId] then
             for _, obj in pairs(ESPDrawings[player.UserId]) do
                if obj then
                    obj:Destroy()
                end
            end
            ESPDrawings[player.UserId] = nil
        end
    end)
end)
